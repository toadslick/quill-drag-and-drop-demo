{"version":3,"sources":["quill/TokenBlot.js","quill/insertToken.js","components/Token.js","quill/TokenDrop.js","components/Editor.js","App.js","index.js"],"names":["TokenBlot","title","slug","id","node","textContent","setAttribute","dataset","Quill","import","blotName","tagName","className","insertToken","quill","tokenData","index","getSelection","getLength","insertEmbed","insertText","setSelection","TAG","toLowerCase","Token","quillRef","draggable","onDragStart","event","text","json","JSON","stringify","dataTransfer","setData","onClick","current","role","TokenDrop","this","onDrop","bind","onSelectionChange","root","addEventListener","on","getData","preventDefault","document","caretRangeFromPoint","selection","range","clientX","clientY","setBaseAndExtent","startContainer","startOffset","parse","token","Parchment","find","target","offset","scroll","window","querySelectorAll","forEach","containsNode","classList","add","remove","CONFIG","formats","modules","toolbar","theme","Editor","value","onChange","useState","editor","setEditor","ref","container","innerHTML","html","dom","DOMParser","parseFromString","replaceWith","body","onValueChange","style","height","register","App","useRef","setHtml","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.6e1f1431.chunk.js","sourcesContent":["import Quill from \"quill\";\n\nconst Embed = Quill.import(\"blots/embed\");\n\nexport default class TokenBlot extends Embed {\n  static blotName = \"placeholder-token\";\n  static tagName = \"span\";\n  static className = \"token\";\n\n  static create({ title, slug, id }) {\n    let node = super.create();\n    node.textContent = title;\n    node.setAttribute(\"contenteditable\", \"false\");\n    node.dataset.title = title;\n    node.dataset.slug = slug;\n    node.dataset.id = id;\n    return node;\n  }\n\n  static value(node) {\n    return node.dataset;\n  }\n\n  length() {\n    return 1;\n  }\n}\n","import TokenBlot from \"./TokenBlot\";\n\nconst insertToken = (quill, tokenData) => {\n  const index = (quill.getSelection() || {}).index || quill.getLength() || 0;\n  quill.insertEmbed(index, TokenBlot.blotName, tokenData);\n  quill.insertText(index + 1, \" \");\n  quill.setSelection(index + 2);\n};\n\nexport default insertToken;\n","import React from \"react\";\n\nimport insertToken from \"../quill/insertToken\";\nimport TokenBlot from \"../quill/TokenBlot\";\n\nconst TAG = TokenBlot.tagName.toLowerCase();\n\nconst Token = ({ title, slug, id, quillRef }) => {\n  const tokenData = { title, slug, id };\n  const onDragStart = event => {\n    const text = `{{${slug}|${id}}}`;\n    const json = JSON.stringify({ title, slug, id });\n    event.dataTransfer.setData(\"text/plain\", text);\n    event.dataTransfer.setData(\"application/vnd.placeholder.token\", json);\n  };\n\n  const onClick = () => {\n    const quill = quillRef.current;\n    if (quill) {\n      insertToken(quill, tokenData);\n    }\n  };\n\n  return (\n    <TAG\n      className={TokenBlot.className}\n      draggable=\"true\"\n      onDragStart={onDragStart}\n      onClick={onClick}\n      role=\"button\"\n    >\n      {title}\n    </TAG>\n  );\n};\n\nexport default Token;\n","import Parchment from \"parchment\";\n\nimport TokenBlot from \"./TokenBlot\";\nimport insertToken from \"./insertToken\";\n\nexport const TOKEN_MODULE_NAME = \"token-drop\";\n\nexport default class TokenDrop {\n  constructor(quill) {\n    this.quill = quill;\n    this.onDrop = this.onDrop.bind(this);\n    this.onClick = this.onClick.bind(this);\n    this.onSelectionChange = this.onSelectionChange.bind(this);\n    this.quill.root.addEventListener(\"drop\", this.onDrop, false);\n    this.quill.root.addEventListener(\"click\", this.onClick, false);\n    this.quill.on(\"selection-change\", this.onSelectionChange);\n  }\n\n  onDrop(event) {\n    const quill = this.quill;\n    const tokenData = event.dataTransfer.getData(\n      \"application/vnd.placeholder.token\"\n    );\n\n    // If the dropped item is a placeholder token AND a Quill instance is initialized:\n    // - Call `preventDefault()` to prevent the token's raw text from being added to the editor.\n    // - Use the Quill API to add a token embed into the editor.\n    if (tokenData && quill) {\n      event.preventDefault();\n\n      // Get the index of the native insertion point.\n      // Drag events do not update Quill's selection so it must be calculated manually.\n      // Cribbed from: https://github.com/kensnyder/quill-image-drop-module\n      if (document.caretRangeFromPoint) {\n        const selection = document.getSelection();\n        const range = document.caretRangeFromPoint(\n          event.clientX,\n          event.clientY\n        );\n        if (selection && range) {\n          selection.setBaseAndExtent(\n            range.startContainer,\n            range.startOffset,\n            range.startContainer,\n            range.startOffset\n          );\n        }\n      }\n      insertToken(quill, JSON.parse(tokenData));\n    }\n  }\n\n  onClick(event) {\n    const token = Parchment.find(event.target);\n    if (token instanceof TokenBlot) {\n      this.quill.setSelection(token.offset(this.quill.scroll), 1, \"user\");\n    }\n  }\n\n  onSelectionChange() {\n    const selectedClassName = \"selected\";\n    const selection = window.getSelection();\n    const tokens = this.quill.root.querySelectorAll(\n      `${TokenBlot.tagName}.${TokenBlot.className}`\n    );\n    tokens.forEach(node => {\n      if (selection.containsNode(node, true)) {\n        node.classList.add(selectedClassName);\n      } else {\n        node.classList.remove(selectedClassName);\n      }\n    });\n  }\n}\n","import React, { useState } from \"react\";\nimport Quill from \"quill\";\nimport TokenBlot from \"../quill/TokenBlot\";\nimport { TOKEN_MODULE_NAME } from \"../quill/TokenDrop\";\n\nconst CONFIG = {\n  formats: [\"bold\", \"italic\", TokenBlot.blotName],\n  modules: {\n    toolbar: [[\"bold\", \"italic\"]],\n    [TOKEN_MODULE_NAME]: true\n  },\n  theme: \"snow\"\n};\n\nconst Editor = ({ value, onChange, quillRef }) => {\n  const [editor, setEditor] = useState(null);\n\n  // Replace the token nodes with placeholder syntax text.\n  // In a production app this should only be done once when submitting\n  // instead of after every text change.\n  const onValueChange = html => {\n    const parser = new DOMParser();\n    const dom = parser.parseFromString(html, \"text/html\");\n    dom.querySelectorAll(\".token\").forEach(token => {\n      const {\n        dataset: { id, slug }\n      } = token;\n      token.replaceWith(`{{${slug}|${id}}}`);\n    });\n    onChange(dom.body.innerHTML);\n  };\n\n  // When the containing div is mounted, initialize the Quill instance.\n  // Don't mount if an instance already exists!\n  const onMount = container => {\n    if (!editor && container) {\n      // Set the innerHTML once so that Quill is initialized with the starting value.\n      container.innerHTML = value;\n      const quill = new Quill(container, CONFIG);\n      quill.on(\"text-change\", () => onValueChange(quill.root.innerHTML));\n      setEditor(quill);\n      quillRef.current = quill;\n    }\n  };\n\n  return <div ref={onMount} style={{ height: 200 }} />;\n};\n\nexport default Editor;\n","import React, { useState, useRef } from \"react\";\nimport Token from \"./components/Token\";\nimport Editor from \"./components/Editor\";\n\nimport Quill from \"quill\";\nimport TokenBlot from \"./quill/TokenBlot\";\nimport TokenDrop, { TOKEN_MODULE_NAME } from \"./quill/TokenDrop\";\nimport \"quill/dist/quill.snow.css\";\n\n// Regisger the token embed and the drap-drop module with the Quill library,\n// so that they are available to any Quill instance.\nQuill.register(TokenBlot);\nQuill.register(`modules/${TOKEN_MODULE_NAME}`, TokenDrop);\n\nfunction App() {\n  const quillRef = useRef(null);\n\n  const [html, setHtml] = useState(\n    \"<p>The <strong>quick brown fox</strong> jumps over the <em>lazy dog</em>.</p>\"\n  );\n\n  return (\n    <div id=\"app\">\n      <aside>\n        <h1>Tokens</h1>\n        <ul className=\"token-list\">\n          <li>\n            <Token\n              title=\"first name\"\n              slug=\"first_name\"\n              id=\"123\"\n              quillRef={quillRef}\n            />\n          </li>\n          <li>\n            <Token\n              title=\"last name\"\n              slug=\"last_name\"\n              id=\"456\"\n              quillRef={quillRef}\n            />\n          </li>\n          <li>\n            <Token\n              title=\"email address\"\n              slug=\"email\"\n              id=\"789\"\n              quillRef={quillRef}\n            />\n          </li>\n        </ul>\n      </aside>\n      <section>\n        <h1>Editor</h1>\n        <p>\n          Note: only <strong>bold</strong>, <strong>italic</strong>, and{\" \"}\n          <strong>tokens</strong> are enabled.\n        </p>\n        <Editor value={html} onChange={setHtml} quillRef={quillRef} />\n        <h1>Output</h1>\n        <div id=\"result\">{html}</div>\n      </section>\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}